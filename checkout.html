<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Checkout</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="css/checkout.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&family=Outfit:wght@100..900&family=Overpass:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap"
        rel="stylesheet">
    <!-- Header + Footer Components -->
    <script src="components/header.js" type="text/javascript" defer></script>
    <script src="components/footer.js" type="text/javascript" defer></script>
</head>

<body>
    <header-component></header-component>
    <div class="container">
        <div class="row g-3">
            <div class="col-7">
                <form class="row g-3 needs-validation">
                    <h3>Contact</h3>
                    <div class="col-12">
                        <label for="inputEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="inputEmail" required value="tanna@gmail.com">
                    </div>
                    <h3>Delivery</h3>
                    <div class="col-12 country-container">
                        <label for="countries" class="form-label">Country: </label>
                        <br>
                        <select class="countries" name="countries" id="countries" required>
                            <option value="">Select a Country</option>
                            <option value="SG" selected>Singapore</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label for="inputAddress" class="form-label">Address</label>
                        <input type="text" class="form-control" id="inputAddress" 
                            placeholder="Tampines Street 21" required value="Tampines Street 21">
                    </div>
                    <div class="col-md-8">
                        <label for="inputCity" class="form-label">City</label>
                        <input type="text" class="form-control" id="inputCity" 
                            required value="Singapore">
                    </div>
                    <div class="col-md-4">
                        <label for="inputZip" class="form-label">Zip/Postal</label>
                        <input type="text" class="form-control" id="inputZip" 
                            required value="543210">
                    </div>
                    <div class="col-12">
                    </div>
                    <h3>Payment</h3>
                    <div class="my-3">
                        <div class="form-check">
                            <input id="credit" name="paymentMethod" type="radio" class="form-check-input" checked
                                required>
                            <label class="form-check-label" for="credit">Credit card</label>
                        </div>
                        <div class="form-check">
                            <input id="debit" name="paymentMethod" type="radio" class="form-check-input" 
                            required>
                            <label class="form-check-label" for="debit">Debit card</label>
                        </div>
                        <div class="form-check">
                            <input id="paypal" name="paymentMethod" type="radio" class="form-check-input" 
                            required>
                            <label class="form-check-label" for="paypal">PayPal</label>
                        </div>
                    </div>
                    <div class="row gy-3">
                        <div class="col-md-6">
                            <label for="cc-name" class="form-label">Name on card</label>
                            <input type="text" class="form-control" id="cc-name" placeholder="" 
                            required value="Jackson Lim">
                            <small class="text-body-secondary">Full name as displayed on card</small>
                            <div class="invalid-feedback">
                                Name on card is required
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="cc-number" class="form-label">Credit card number</label>
                            <input type="text" class="form-control" id="cc-number" placeholder="" 
                            required value="4111-1111-1111-1111">
                            <div class="invalid-feedback">
                                Credit card number is required
                            </div>
                        </div>
                        <div class="col-md-3">
                            <label for="cc-expiration" class="form-label">Expiration (mm/yyyy)</label>
                            <input type="text" class="form-control" id="cc-expiration" placeholder="" 
                            required value="02/2029">
                            <div class="invalid-feedback">
                                Expiration date required
                            </div>
                        </div>
                        <div class="col-md-3">
                            <label for="cc-cvv" class="form-label">CVV</label>
                            <input type="text" class="form-control" id="cc-cvv" placeholder="" 
                            required value="888">
                            <div class="invalid-feedback">
                                Security code required
                            </div>
                        </div>
                        <div class="col-12">
                            <button type="button" class="btn btn-secondary" id="btnSubmitCheckout">
                                Check Out
                            </button>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="gridCheck">
                            <label class="form-check-label" for="gridCheck">
                                Remember payment details
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-5">
                <h4 class="d-flex justify-content-between align-items-center mb-3">
                    <span>
                        <h3> Your Cart</h3>
                    </span>
                    <span class="badge bg-secondary rounded-pill">3</span>
                </h4>
                <ul class="list-group mb-3">
                    <li class="list-group-item d-flex justify-content-between lh-sm">
                        <div>
                            <h6 class="my-0" id="card-title">
                                <!-- TODO: Name here -->
                            </h6>
                            <small class="text-body-secondary" id="card-description">
                                <!-- TODO: Description here -->
                            </small>
                        </div>
                        <span class="text-body-secondary" id="card-price">
                            <!-- TODO: Price -->
                        </span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Total (SGD)</span>
                        <strong id="card-price-total">
                            <!-- TODO: Price -->
                        </strong>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <footer-component></footer-component>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="/components/auth.js"></script>
    <script src="/components/checkout.js"></script>
    <script src="/components/cart.js"></script>
    <script src="/components/validation.js"></script>
    <script>

         // TODO: get the athenication token (DONE)
         const authenticated = auth();

         // TODO: display the cart item - using cart.js (DONE)
        const cartResult = async ()=>{

            var urlParams = new URLSearchParams(window.location.search);
            let package = urlParams.get("package");

            const cartItem =await getCart(authenticated, package);
            
            // Product Title
            let cartTitle = cartItem.name;
            cartTitle = cartTitle.charAt(0).toUpperCase() + cartTitle.slice(1);
            document.getElementById("card-title").innerText = cartTitle;

            // Product Description
            let cartDesc = cartItem.description;
            cartDesc = cartDesc.charAt(0).toUpperCase() + cartDesc.slice(1);
            document.getElementById("card-description").innerText = cartDesc;

            // Product Description
            let cartPrice = cartItem.price;
            cartPrice = (Math.round(cartPrice * 100) / 100).toFixed(2);
            document.getElementById("card-price").innerText = `$${cartPrice}`;
            document.getElementById("card-price-total").innerText = `$${cartPrice}`;
        };

        cartResult();

        document.getElementById("btnSubmitCheckout").addEventListener("click", async(event) => {
            event.preventDefault();
            event.stopPropagation();

            let urlParams = new URLSearchParams(window.location.search);
            let package = urlParams.get("package");
            let quantity = urlParams.get("qty");

            
            const email = decodeUser(authenticated);
            const mailing_address = document.getElementById("inputAddress").value;
            const product_id = package; 
            const qty = quantity;

            const result = await addSubscription(authenticated, product_id, {email, mailing_address, product_id, qty});
       
            if(result === true){
                window.location.replace("profile.html?subscribe=true");
            }
       
        })

    </script>
</body>

</html>